<!DOCTYPE html>
<html>
<head>
    <title>Toggle Test</title>
</head>
<body>
    <h1>ClaudeForge Toggle Test</h1>
    <button onclick="testToggle()">Test Toggle Behavior</button>
    <pre id="output"></pre>
    
    <script>
        async function testToggle() {
            const output = document.getElementById('output');
            output.textContent = 'Testing...\n';
            
            try {
                // Get sessions
                const sessionsRes = await fetch('http://localhost:8080/api/sessions');
                const sessions = await sessionsRes.json();
                output.textContent += `Sessions: ${JSON.stringify(sessions, null, 2)}\n\n`;
                
                if (sessions.length === 0) {
                    output.textContent += 'No sessions found!\n';
                    return;
                }
                
                const sessionId = sessions[0].id;
                output.textContent += `Using session: ${sessionId}\n\n`;
                
                // Check current permission
                const permsRes1 = await fetch(`http://localhost:8080/api/sessions/${sessionId}/permissions`);
                const perms1 = await permsRes1.json();
                const readFilePerm1 = perms1.find(p => p.key === 'filesystem:read_file');
                output.textContent += `Before toggle - read_file enabled: ${readFilePerm1?.enabled}\n`;
                
                // Toggle off
                const toggleRes = await fetch(`http://localhost:8080/api/sessions/${sessionId}/permissions/filesystem/read_file`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        serverId: 'filesystem',
                        toolName: 'read_file',
                        enabled: false,
                        permissions: { read: true, write: true, execute: true }
                    })
                });
                const toggleResult = await toggleRes.json();
                output.textContent += `Toggle result: ${JSON.stringify(toggleResult)}\n\n`;
                
                // Check permission after toggle
                const permsRes2 = await fetch(`http://localhost:8080/api/sessions/${sessionId}/permissions`);
                const perms2 = await permsRes2.json();
                const readFilePerm2 = perms2.find(p => p.key === 'filesystem:read_file');
                output.textContent += `After toggle - read_file enabled: ${readFilePerm2?.enabled}\n`;
                output.textContent += `Full permission: ${JSON.stringify(readFilePerm2, null, 2)}\n`;
                
            } catch (error) {
                output.textContent += `Error: ${error}\n`;
            }
        }
        
        // Auto-run on load
        window.onload = testToggle;
    </script>
</body>
</html>